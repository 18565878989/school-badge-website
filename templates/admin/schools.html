{% extends "admin/base.html" %}

{% block title %}{{ _('manage_schools') }} - {{ _('admin_panel') }}{% endblock %}

{% block content %}
<div class="admin-header">
    <h1>{{ _('manage_schools') }}</h1>
    <a href="{{ url_for('admin_add_school') }}" class="btn btn-primary">
        ‚ûï {{ _('add_school') }}
    </a>
</div>

<div class="filter-bar">
    <input type="text" id="searchSchools" placeholder="ÊêúÁ¥¢Â≠¶Ê†°..." onkeyup="filterTable()">
    <select id="filterRegion" onchange="filterTable()">
        <option value="">ÊâÄÊúâÂú∞Âå∫</option>
        {% for region in ['North America', 'Europe', 'Asia', 'Oceania', 'Africa', 'South America'] %}
            <option value="{{ region }}">{{ region }}</option>
        {% endfor %}
    </select>
</div>

<table class="admin-table" id="schoolsTable">
    <thead>
        <tr>
            <th>ID</th>
            <th>Ê†°ÂæΩ</th>
            <th>Â≠¶Ê†°ÂêçÁß∞</th>
            <th>‰∏≠ÊñáÂêç</th>
            <th>Âú∞Âå∫</th>
            <th>Á±ªÂûã</th>
            <th>Êìç‰Ωú</th>
        </tr>
    </thead>
    <tbody>
        {% for school in schools %}
        <tr data-region="{{ school.region }}">
            <td>{{ school.id }}</td>
            <td>
                {% if school.badge_url %}
                    <img src="{{ school.badge_url }}" alt="{{ school.name }}" class="table-badge">
                {% else %}
                    <span class="no-badge">‚Äî</span>
                {% endif %}
            </td>
            <td>
                <a href="{{ url_for('school_detail', school_id=school.id) }}" target="_blank">
                    {{ school.name }}
                </a>
            </td>
            <td>{{ school.name_cn or '‚Äî' }}</td>
            <td>{{ school.region }}</td>
            <td>
                <span class="level-badge level-{{ school.level }}">
                    {% if school.level == 'university' %}Â§ßÂ≠¶
                    {% elif school.level == 'middle' %}‰∏≠Â≠¶
                    {% elif school.level == 'elementary' %}Â∞èÂ≠¶
                    {% else %}ÂπºÂÑøÂõ≠{% endif %}
                </span>
            </td>
            <td>
                <div class="action-group">
                    <a href="{{ url_for('admin_edit_school', school_id=school.id) }}" class="btn btn-sm btn-secondary">
                        ‚úèÔ∏è {{ _('edit_school') }}
                    </a>
                    <a href="{{ url_for('admin_delete_school', school_id=school.id) }}" 
                       class="btn btn-sm btn-danger"
                       onclick="return confirm('{{ _('confirm_delete') }}')">
                        üóëÔ∏è {{ _('delete') }}
                    </a>
                </div>
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="7" class="empty">ÊöÇÊó†Â≠¶Ê†°Êï∞ÊçÆ</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
function filterTable() {
    const search = document.getElementById('searchSchools').value.toLowerCase();
    const region = document.getElementById('filterRegion').value;
    const rows = document.querySelectorAll('#schoolsTable tbody tr');
    
    rows.forEach(row => {
        const name = row.cells[2]?.textContent.toLowerCase() || '';
        const rowRegion = row.dataset.region || '';
        
        const matchesSearch = name.includes(search);
        const matchesRegion = !region || rowRegion === region;
        
        row.style.display = (matchesSearch && matchesRegion) ? '' : 'none';
    });
}
</script>
{% endblock %}
