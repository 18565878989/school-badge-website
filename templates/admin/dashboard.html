{% extends "admin/base.html" %}

{% block content %}
<div class="admin-header animate-in">
    <div>
        <h1>{{ _('welcome_admin') }}</h1>
        <p>ç®¡ç†æ‚¨çš„æ ¡å¾½æ”¶è—</p>
    </div>
    <div class="admin-header-actions">
        <a href="{{ url_for('admin_add_school') }}" class="btn btn-primary">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            {{ _('add_school') }}
        </a>
    </div>
</div>

<!-- Stats Grid -->
<div class="stats-grid">
    <div class="stat-card animate-in">
        <div class="stat-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="#1E3A5F" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 10v6M2 10l10-5 10 5-10 5z"/>
                <path d="M6 12v5c0 2 2 3 6 3s6-1 6-3v-5"/>
            </svg>
        </div>
        <div class="stat-info">
            <p class="stat-value">{{ stats.total_schools }}</p>
            <p class="stat-label">å­¦æ ¡æ€»æ•°</p>
        </div>
    </div>
    
    <div class="stat-card animate-in">
        <div class="stat-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="#007AFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
            </svg>
        </div>
        <div class="stat-info">
            <p class="stat-value">{{ stats.total_users }}</p>
            <p class="stat-label">ç”¨æˆ·æ€»æ•°</p>
        </div>
    </div>
    
    <div class="stat-card animate-in">
        <div class="stat-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="#34C759" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <line x1="2" y1="12" x2="22" y2="12"/>
                <path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/>
            </svg>
        </div>
        <div class="stat-info">
            <p class="stat-value">{{ stats.total_regions }}</p>
            <p class="stat-label">åœ°åŒºæ•°</p>
        </div>
    </div>
    
    <div class="stat-card animate-in">
        <div class="stat-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="#FF9500" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/>
                <circle cx="12" cy="10" r="3"/>
            </svg>
        </div>
        <div class="stat-info">
            <p class="stat-value">{{ stats.hk_schools or 0 }}</p>
            <p class="stat-label">é¦™æ¸¯å­¦æ ¡</p>
        </div>
    </div>
    
    <div class="stat-card animate-in">
        <div class="stat-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="#AF52DE" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
        </div>
        <div class="stat-info">
            <p class="stat-value">{{ stats.university_count or 0 }}</p>
            <p class="stat-label">å¤§å­¦</p>
        </div>
    </div>
    
    <div class="stat-card animate-in">
        <div class="stat-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="#D4AF37" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
            </svg>
        </div>
        <div class="stat-info">
            <p class="stat-value">{{ stats.last_updated or 'â€”' }}</p>
            <p class="stat-label">æœ€åæ›´æ–°</p>
        </div>
    </div>
</div>

<!-- Data Sources Card -->
<div class="card animate-in">
    <div class="card-header">
        <h2>ğŸ“Š æ•°æ®æ¥æºç»Ÿè®¡</h2>
    </div>
    <div class="card-body">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px;">
            <div style="text-align: center; padding: 24px; background: var(--bg-secondary); border-radius: var(--radius-xs);">
                <div style="font-size: 2rem; font-weight: 700; color: #007AFF;">{{ stats.schooland_count or 0 }}</div>
                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 4px;">schooland.hk</div>
            </div>
            <div style="text-align: center; padding: 24px; background: var(--bg-secondary); border-radius: var(--radius-xs);">
                <div style="font-size: 2rem; font-weight: 700; color: #34C759;">{{ stats.manual_count or 0 }}</div>
                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 4px;">æ‰‹åŠ¨æ·»åŠ </div>
            </div>
            <div style="text-align: center; padding: 24px; background: var(--bg-secondary); border-radius: var(--radius-xs);">
                <div style="font-size: 2rem; font-weight: 700; color: #FF9500;">{{ stats.edb_count or 0 }}</div>
                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 4px;">EDB æ•°æ®</div>
            </div>
            <div style="text-align: center; padding: 24px; background: var(--bg-secondary); border-radius: var(--radius-xs);">
                <div style="font-size: 2rem; font-weight: 700; color: var(--primary);">{{ stats.total_schools }}</div>
                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 4px;">æ€»è®¡å­¦æ ¡</div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Data -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 24px; margin-top: 24px;">
    <!-- Recent Schools -->
    <div class="card animate-in">
        <div class="card-header">
            <h2>æœ€è¿‘æ·»åŠ çš„å­¦æ ¡</h2>
            <a href="{{ url_for('admin_schools') }}" class="btn btn-secondary btn-sm">æŸ¥çœ‹å…¨éƒ¨ â†’</a>
        </div>
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>å­¦æ ¡åç§°</th>
                        <th>åœ°åŒº</th>
                        <th>æ¥æº</th>
                    </tr>
                </thead>
                <tbody>
                    {% for school in recent_schools %}
                    <tr>
                        <td>{{ school.id }}</td>
                        <td>
                            <a href="{{ url_for('school_detail', school_id=school.id) }}" target="_blank">
                                {{ school.name[:35] }}{% if school.name|length > 35 %}...{% endif %}
                            </a>
                        </td>
                        <td>{{ school.region }}</td>
                        <td>
                            {% if school.source == 'schooland.hk' %}
                                <span class="badge badge-primary">schooland.hk</span>
                            {% else %}
                                <span class="badge badge-success">æ‰‹åŠ¨</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4">
                            <div class="empty-state">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M22 10v6M2 10l10-5 10 5-10 5z"/>
                                    <path d="M6 12v5c0 2 2 3 6 3s6-1 6-3v-5"/>
                                </svg>
                                <h3>æš‚æ— æ•°æ®</h3>
                                <p>è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•å­¦æ ¡</p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Recent Users -->
    <div class="card animate-in">
        <div class="card-header">
            <h2>æœ€è¿‘æ³¨å†Œçš„ç”¨æˆ·</h2>
            <a href="{{ url_for('admin_users') }}" class="btn btn-secondary btn-sm">æŸ¥çœ‹å…¨éƒ¨ â†’</a>
        </div>
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ç”¨æˆ·å</th>
                        <th>é‚®ç®±</th>
                        <th>è§’è‰²</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in recent_users %}
                    <tr>
                        <td>{{ user.id }}</td>
                        <td>{{ user.username }}</td>
                        <td>{{ user.email[:25] }}{% if user.email|length > 25 %}...{% endif %}</td>
                        <td>
                            {% if user.role == 'admin' %}
                                <span class="badge badge-warning">ç®¡ç†å‘˜</span>
                            {% else %}
                                <span class="badge badge-secondary">ç”¨æˆ·</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4">
                            <div class="empty-state">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                                    <circle cx="9" cy="7" r="4"/>
                                </svg>
                                <h3>æš‚æ— æ•°æ®</h3>
                                <p>è¿˜æ²¡æœ‰æ³¨å†Œç”¨æˆ·</p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="card animate-in" style="margin-top: 24px;">
    <div class="card-header">
        <h2>âš¡ å¿«æ·æ“ä½œ</h2>
    </div>
    <div class="card-body">
        <div style="display: flex; gap: 16px; flex-wrap: wrap;">
            <a href="{{ url_for('admin_add_school') }}" class="btn btn-primary">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                æ·»åŠ å­¦æ ¡
            </a>
            <a href="{{ url_for('admin_users') }}" class="btn btn-secondary">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                    <circle cx="8.5" cy="7" r="4"/>
                    <line x1="20" y1="8" x2="20" y2="14"/>
                    <line x1="23" y1="11" x2="17" y2="11"/>
                </svg>
                ç®¡ç†ç”¨æˆ·
            </a>
            <a href="{{ url_for('index') }}" class="btn btn-secondary" target="_blank">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="2" y1="12" x2="22" y2="12"/>
                    <path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/>
                </svg>
                è®¿é—®å‰å°
            </a>
            <a href="{{ url_for('campus_north_america') }}" class="btn btn-secondary" target="_blank">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                    <circle cx="8.5" cy="8.5" r="1.5"/>
                    <polyline points="21 15 16 10 5 21"/>
                </svg>
                æ ¡å›­ç”»å»Š
            </a>
        </div>
    </div>
</div>
{% endblock %}
