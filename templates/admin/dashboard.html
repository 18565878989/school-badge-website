{% extends "admin/base.html" %}

{% block title %}{{ _('dashboard') }} - {{ _('admin_panel') }}{% endblock %}

{% block content %}
<div class="admin-header">
    <h1>{{ _('welcome_admin') }}</h1>
    <p>{{ _('admin_panel') }}</p>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">ğŸ«</div>
        <div class="stat-info">
            <p class="stat-value">{{ stats.total_schools }}</p>
            <p class="stat-label">{{ _('total_schools') }}</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">ğŸ‘¥</div>
        <div class="stat-info">
            <p class="stat-value">{{ stats.total_users }}</p>
            <p class="stat-label">{{ _('total_users') }}</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">ğŸŒ</div>
        <div class="stat-info">
            <p class="stat-value">{{ stats.total_regions }}</p>
            <p class="stat-label">åœ°åŒºæ€»æ•°</p>
        </div>
    </div>
    <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
        <div class="stat-icon">ğŸ“Š</div>
        <div class="stat-info">
            <p class="stat-value">{{ stats.hk_schools or 0 }}</p>
            <p class="stat-label">é¦™æ¸¯å­¦æ ¡</p>
        </div>
    </div>
</div>

<!-- æ•°æ®æ¥æºç»Ÿè®¡ -->
<div class="stats-section">
    <h2>ğŸ“Š æ•°æ®æ¥æºç»Ÿè®¡</h2>
    <div class="source-stats">
        <div class="source-card">
            <div class="source-name">schooland.hk</div>
            <div class="source-count">{{ stats.schooland_count or 0 }}</div>
            <div class="source-label">æ‰€å­¦æ ¡</div>
        </div>
        <div class="source-card">
            <div class="source-name">æ‰‹åŠ¨æ·»åŠ </div>
            <div class="source-count">{{ stats.manual_count or 0 }}</div>
            <div class="source-label">æ‰€å­¦æ ¡</div>
        </div>
        <div class="source-card">
            <div class="source-name">æœ€åæ›´æ–°</div>
            <div class="source-count">{{ stats.last_updated or 'â€”' }}</div>
            <div class="source-label">æ›´æ–°æ—¶é—´</div>
        </div>
    </div>
</div>

<div class="admin-sections">
    <div class="admin-section">
        <div class="section-header">
            <h2>æœ€è¿‘æ·»åŠ çš„å­¦æ ¡</h2>
            <a href="{{ url_for('admin_schools') }}" class="btn btn-primary btn-sm">æŸ¥çœ‹å…¨éƒ¨</a>
        </div>
        <table class="admin-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>å­¦æ ¡åç§°</th>
                    <th>åœ°åŒº</th>
                    <th>æ¥æº</th>
                    <th>æ—¶é—´</th>
                </tr>
            </thead>
            <tbody>
                {% for school in recent_schools %}
                <tr>
                    <td>{{ school.id }}</td>
                    <td>
                        <a href="{{ url_for('school_detail', school_id=school.id) }}" target="_blank">
                            {{ school.name }}
                        </a>
                    </td>
                    <td>{{ school.region }}</td>
                    <td>
                        {% if school.source == 'schooland.hk' %}
                            <span class="source-badge source-schooland">schooland.hk</span>
                        {% else %}
                            <span class="source-badge source-manual">æ‰‹åŠ¨</span>
                        {% endif %}
                    </td>
                    <td>{{ school.updated_at[:10] if school.updated_at else school.created_at[:10] }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" class="empty">æš‚æ— æ•°æ®</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <div class="admin-section">
        <div class="section-header">
            <h2>æœ€è¿‘æ³¨å†Œçš„ç”¨æˆ·</h2>
            <a href="{{ url_for('admin_users') }}" class="btn btn-primary btn-sm">æŸ¥çœ‹å…¨éƒ¨</a>
        </div>
        <table class="admin-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>ç”¨æˆ·å</th>
                    <th>é‚®ç®±</th>
                    <th>è§’è‰²</th>
                </tr>
            </thead>
            <tbody>
                {% for user in recent_users %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.username }}</td>
                    <td>{{ user.email }}</td>
                    <td>
                        {% if user.role == 'admin' %}
                            <span class="badge badge-admin">ç®¡ç†å‘˜</span>
                        {% else %}
                            <span class="badge badge-user">ç”¨æˆ·</span>
                        {% endif %}
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="4" class="empty">æš‚æ— æ•°æ®</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="quick-actions">
    <h2>å¿«æ·æ“ä½œ</h2>
    <div class="action-buttons">
        <a href="{{ url_for('admin_add_school') }}" class="btn btn-primary">
            â• {{ _('add_school') }}
        </a>
        <a href="{{ url_for('admin_users') }}" class="btn btn-secondary">
            ğŸ‘¥ {{ _('manage_users') }}
        </a>
        <a href="{{ url_for('index') }}" class="btn btn-secondary" target="_blank">
            ğŸŒ {{ _('home') }}
        </a>
    </div>
</div>

<style>
.stats-section {
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.stats-section h2 {
    margin: 0 0 15px 0;
    font-size: 18px;
    color: #333;
}

.source-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.source-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
}

.source-card:nth-child(2) {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}

.source-card:nth-child(3) {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
}

.source-name {
    font-size: 14px;
    opacity: 0.9;
}

.source-count {
    font-size: 28px;
    font-weight: bold;
    margin: 5px 0;
}

.source-label {
    font-size: 12px;
    opacity: 0.8;
}

.source-badge {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 11px;
}

.source-schooland {
    background: #e3f2fd;
    color: #1976d2;
}

.source-manual {
    background: #f5f5f5;
    color: #666;
}

.admin-sections {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 20px;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.section-header h2 {
    margin: 0;
    font-size: 18px;
    color: #333;
}
</style>
{% endblock %}
