{% extends "admin/base.html" %}

{% block title %}{{ _('dashboard') }} - {{ _('admin_panel') }}{% endblock %}

{% block content %}
<div class="admin-header">
    <h1>{{ _('welcome_admin') }}</h1>
    <p>Manage your school badge collection</p>
</div>

<!-- Stats Grid -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#1E3A5F" stroke-width="2">
                <path d="M22 10v6M2 10l10-5 10 5-10 5z"/>
                <path d="M6 12v5c0 2 2 3 6 3s6-1 6-3v-5"/>
            </svg>
        </div>
        <div class="stat-info">
            <p class="stat-value">{{ stats.total_schools }}</p>
            <p class="stat-label">{{ _('total_schools') }}</p>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#007AFF" stroke-width="2">
                <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/>
            </svg>
        </div>
        <div class="stat-info">
            <p class="stat-value">{{ stats.total_users }}</p>
            <p class="stat-label">{{ _('total_users') }}</p>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#34C759" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/>
            </svg>
        </div>
        <div class="stat-info">
            <p class="stat-value">{{ stats.total_regions }}</p>
            <p class="stat-label">åœ°åŒºæ€»æ•°</p>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#FF9500" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/>
                <circle cx="12" cy="10" r="3"/>
            </svg>
        </div>
        <div class="stat-info">
            <p class="stat-value">{{ stats.hk_schools or 0 }}</p>
            <p class="stat-label">é¦™æ¸¯å­¦æ ¡</p>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#AF52DE" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
        </div>
        <div class="stat-info">
            <p class="stat-value">{{ stats.university_count or 0 }}</p>
            <p class="stat-label">å¤§å­¦æ•°é‡</p>
        </div>
    </div>
</div>

<!-- Data Source Stats -->
<div class="stats-section">
    <h2>ğŸ“Š æ•°æ®æ¥æºç»Ÿè®¡</h2>
    <div class="source-stats">
        <div class="source-card">
            <div class="source-name">schooland.hk</div>
            <div class="source-count">{{ stats.schooland_count or 0 }}</div>
            <div class="source-label">æ‰€å­¦æ ¡</div>
        </div>
        <div class="source-card">
            <div class="source-name">æ‰‹åŠ¨æ·»åŠ </div>
            <div class="source-count">{{ stats.manual_count or 0 }}</div>
            <div class="source-label">æ‰€å­¦æ ¡</div>
        </div>
        <div class="source-card">
            <div class="source-name">æœ€åæ›´æ–°</div>
            <div class="source-count">{{ stats.last_updated or 'â€”' }}</div>
            <div class="source-label">æ›´æ–°æ—¶é—´</div>
        </div>
    </div>
</div>

<!-- Admin Sections -->
<div class="admin-sections">
    <!-- Recent Schools -->
    <div class="admin-section">
        <div class="section-header">
            <h2>æœ€è¿‘æ·»åŠ çš„å­¦æ ¡</h2>
            <a href="{{ url_for('admin_schools') }}" class="btn btn-secondary btn-sm">
                æŸ¥çœ‹å…¨éƒ¨ â†’
            </a>
        </div>
        <table class="admin-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>å­¦æ ¡åç§°</th>
                    <th>åœ°åŒº</th>
                    <th>æ¥æº</th>
                </tr>
            </thead>
            <tbody>
                {% for school in recent_schools %}
                <tr>
                    <td>{{ school.id }}</td>
                    <td>
                        <a href="{{ url_for('school_detail', school_id=school.id) }}" target="_blank">
                            {{ school.name }}
                        </a>
                    </td>
                    <td>{{ school.region }}</td>
                    <td>
                        {% if school.source == 'schooland.hk' %}
                            <span class="source-badge source-schooland">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                    <circle cx="12" cy="12" r="10"/>
                                </svg>
                                schooland.hk
                            </span>
                        {% else %}
                            <span class="source-badge source-manual">æ‰‹åŠ¨</span>
                        {% endif %}
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="4" class="empty">æš‚æ— æ•°æ®</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Recent Users -->
    <div class="admin-section">
        <div class="section-header">
            <h2>æœ€è¿‘æ³¨å†Œçš„ç”¨æˆ·</h2>
            <a href="{{ url_for('admin_users') }}" class="btn btn-secondary btn-sm">
                æŸ¥çœ‹å…¨éƒ¨ â†’
            </a>
        </div>
        <table class="admin-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>ç”¨æˆ·å</th>
                    <th>é‚®ç®±</th>
                    <th>è§’è‰²</th>
                </tr>
            </thead>
            <tbody>
                {% for user in recent_users %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.username }}</td>
                    <td>{{ user.email }}</td>
                    <td>
                        {% if user.role == 'admin' %}
                            <span class="badge badge-admin">ç®¡ç†å‘˜</span>
                        {% else %}
                            <span class="badge badge-user">ç”¨æˆ·</span>
                        {% endif %}
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="4" class="empty">æš‚æ— æ•°æ®</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Quick Actions -->
<div class="quick-actions">
    <h2>âš¡ å¿«æ·æ“ä½œ</h2>
    <div class="action-buttons">
        <a href="{{ url_for('admin_add_school') }}" class="btn btn-primary">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            {{ _('add_school') }}
        </a>
        <a href="{{ url_for('admin_users') }}" class="btn btn-secondary">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                <circle cx="8.5" cy="7" r="4"/>
                <line x1="20" y1="8" x2="20" y2="14"/>
                <line x1="23" y1="11" x2="17" y2="11"/>
            </svg>
            {{ _('manage_users') }}
        </a>
        <a href="{{ url_for('index') }}" class="btn btn-secondary" target="_blank">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="2" y1="12" x2="22" y2="12"/>
                <path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/>
            </svg>
            {{ _('home') }}
        </a>
    </div>
</div>
{% endblock %}
