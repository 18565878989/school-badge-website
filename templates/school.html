{% extends "base.html" %}

{% block title %}{{ school.name }} - æ ¡å¾½ç½‘{% endblock %}

{% block content %}
<!-- Navigation Breadcrumb -->
<div class="filters" style="margin-bottom: 24px;">
    <a href="{{ url_for('index') }}" class="filter-group">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            <polyline points="9 22 9 12 15 12 15 22"/>
        </svg>
        {{ _('home') }}
    </a>
    <span style="color: var(--text-tertiary); margin: 0 8px;">/</span>
    <a href="{{ url_for('campus_north_america') }}" class="filter-group">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <circle cx="8.5" cy="8.5" r="1.5"/>
            <polyline points="21 15 16 10 5 21"/>
        </svg>
        {{ _('campus_gallery') }}
    </a>
    {% if not session.get('user_id') %}
    <span style="color: var(--text-tertiary); margin: 0 8px;">/</span>
    <a href="{{ url_for('login') }}" class="filter-group">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
            <polyline points="10 17 15 12 10 7"/>
            <line x1="15" y1="12" x2="3" y2="12"/>
        </svg>
        {{ _('login') }}
    </a>
    <span style="color: var(--text-tertiary); margin: 0 8px;">/</span>
    <a href="{{ url_for('register') }}" class="filter-group">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="8.5" cy="7" r="4"/>
            <line x1="20" y1="8" x2="20" y2="14"/>
            <line x1="23" y1="11" x2="17" y2="11"/>
        </svg>
        {{ _('register') }}
    </a>
    {% else %}
    <span style="color: var(--text-tertiary); margin: 0 8px;">/</span>
    <a href="{{ url_for('my_likes') }}" class="filter-group">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
        </svg>
        {{ _('my_likes') }}
    </a>
    <span style="color: var(--text-tertiary); margin: 0 8px;">/</span>
    <a href="{{ url_for('logout') }}" class="filter-group">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16 17 21 12 16 7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
        </svg>
        {{ _('logout') }}
    </a>
    {% endif %}
</div>

<!-- Main Card - Same Structure as Homepage -->
<div class="school-card" style="display: grid; grid-template-columns: 380px 1fr; max-width: 1100px; margin: 0 auto;">
    <!-- Badge Section -->
    <div class="badge-container">
        {% if school.badge_url %}
            <img src="{{ school.badge_url }}" alt="{{ school.name }} badge" class="badge-image">
        {% else %}
            <div class="badge-placeholder">ðŸŽ“</div>
        {% endif %}
        
        <!-- Action Buttons -->
        <div style="position: absolute; bottom: 20px; left: 20px; right: 20px; display: flex; gap: 12px; z-index: 10;">
            {% if session.get('user_id') %}
                <form action="{{ url_for('toggle_like', school_id=school.id) }}" method="POST" style="flex: 1;">
                    <button type="submit" class="btn {% if user_liked %}btn-primary{% else %}btn-secondary{% endif %}" style="width: 100%; border-radius: 20px; font-weight: 600;">
                        {% if user_liked %}
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="none" style="margin-right: 6px;"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                        {{ _('liked') }}
                        {% else %}
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                        {{ _('like') }}
                        {% endif %}
                    </button>
                </form>
            {% endif %}
            <button onclick="downloadBadge()" class="btn btn-secondary" style="flex: 1; border-radius: 20px; font-weight: 600;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                {{ _('download') }}
            </button>
        </div>
    </div>
    
    <!-- Info Section - Same as Homepage -->
    <div class="school-info">
        <h3>{{ school.name }}</h3>
        
        {% if school.name_cn %}
            <p class="motto">{{ school.name_cn }}</p>
        {% endif %}
        
        {% if school.motto %}
            <p class="motto">"{{ school.motto }}"</p>
        {% endif %}
        
        <p class="location">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
            {{ school.city }}, {{ school.country }}
        </p>
        
        <!-- Level Badge -->
        <span class="level-badge level-{{ school.level }}">
            {% if school.level == 'university' %}{{ _('university') }}
            {% elif school.level == 'middle' %}{{ _('middle_school') }}
            {% elif school.level == 'elementary' %}{{ _('elementary_school') }}
            {% elif school.level == 'kindergarten' %}{{ _('kindergarten') }}
            {% else %}{{ school.level }}{% endif %}
        </span>
        
        <!-- Country Flag -->
        {% set country_flags = {
            'China': 'ðŸ‡¨ðŸ‡³',
            'Hong Kong': 'ðŸ‡­ðŸ‡°',
            'Taiwan': 'ðŸ‡¹ðŸ‡¼',
            'Japan': 'ðŸ‡¯ðŸ‡µ',
            'South Korea': 'ðŸ‡°ðŸ‡·',
            'North Korea': 'ðŸ‡°ðŸ‡µ',
            'United Kingdom': 'ðŸ‡¬ðŸ‡§',
            'United States': 'ðŸ‡ºðŸ‡¸',
            'Canada': 'ðŸ‡¨ðŸ‡¦',
            'Australia': 'ðŸ‡¦ðŸ‡º',
            'Germany': 'ðŸ‡©ðŸ‡ª',
            'France': 'ðŸ‡«ðŸ‡·',
            'Singapore': 'ðŸ‡¸ðŸ‡¬',
            'Malaysia': 'ðŸ‡²ðŸ‡¾',
            'Thailand': 'ðŸ‡¹ðŸ‡­',
            'Vietnam': 'ðŸ‡»ðŸ‡³',
            'Indonesia': 'ðŸ‡®ðŸ‡©',
            'Philippines': 'ðŸ‡µðŸ‡­',
            'India': 'ðŸ‡®ðŸ‡³',
            'Netherlands': 'ðŸ‡³ðŸ‡±',
        } %}
        <span class="country-flag">{{ country_flags.get(school.country, '') }}</span>
        
        <!-- Additional Info Grid -->
        <div style="margin-top: 20px; padding-top: 16px; border-top: 1px solid rgba(0,0,0,0.06);">
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                {% if school.region %}
                <div style="padding: 12px 16px; background: var(--card-bg); border-radius: 12px;">
                    <p style="font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-secondary); margin-bottom: 4px; font-weight: 600;">{{ _('region') }}</p>
                    <p style="font-size: 0.85rem; color: var(--text); font-weight: 500;">{{ school.region }}</p>
                </div>
                {% endif %}
                
                {% if school.district %}
                <div style="padding: 12px 16px; background: var(--card-bg); border-radius: 12px;">
                    <p style="font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-secondary); margin-bottom: 4px; font-weight: 600;">{{ _('district') }}</p>
                    <p style="font-size: 0.85rem; color: var(--text); font-weight: 500;">{{ school.district }}</p>
                </div>
                {% endif %}
                
                {% if school.address %}
                <div style="padding: 12px 16px; background: var(--card-bg); border-radius: 12px; grid-column: span 2;">
                    <p style="font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-secondary); margin-bottom: 4px; font-weight: 600;">{{ _('address') }}</p>
                    <p style="font-size: 0.85rem; color: var(--text); font-weight: 500;">{{ school.address }}</p>
                </div>
                {% endif %}
                
                {% if school.supervisor %}
                <div style="padding: 12px 16px; background: var(--card-bg); border-radius: 12px;">
                    <p style="font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-secondary); margin-bottom: 4px; font-weight: 600;">{{ _('supervisor') }}</p>
                    <p style="font-size: 0.85rem; color: var(--text); font-weight: 500;">{{ school.supervisor }}</p>
                </div>
                {% endif %}
                
                {% if school.principal %}
                <div style="padding: 12px 16px; background: var(--card-bg); border-radius: 12px;">
                    <p style="font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-secondary); margin-bottom: 4px; font-weight: 600;">{{ _('principal') }}</p>
                    <p style="font-size: 0.85rem; color: var(--text); font-weight: 500;">{{ school.principal }}</p>
                </div>
                {% endif %}
                
                {% if school.phone %}
                <div style="padding: 12px 16px; background: var(--card-bg); border-radius: 12px;">
                    <p style="font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-secondary); margin-bottom: 4px; font-weight: 600;">{{ _('phone') }}</p>
                    <p style="font-size: 0.85rem; color: var(--text); font-weight: 500;">{{ school.phone }}</p>
                </div>
                {% endif %}
                
                {% if school.founded %}
                <div style="padding: 12px 16px; background: var(--card-bg); border-radius: 12px;">
                    <p style="font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-secondary); margin-bottom: 4px; font-weight: 600;">{{ _('founded') }}</p>
                    <p style="font-size: 0.85rem; color: var(--text); font-weight: 500;">{{ school.founded }}</p>
                </div>
                {% endif %}
                
                {% if school.website %}
                <div style="padding: 12px 16px; background: var(--card-bg); border-radius: 12px;">
                    <p style="font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-secondary); margin-bottom: 4px; font-weight: 600;">{{ _('website') }}</p>
                    <a href="{{ school.website }}" target="_blank" style="font-size: 0.85rem; color: var(--primary); font-weight: 500;">{{ _('visit_website') }} â†’</a>
                </div>
                {% endif %}
            </div>
            
            <!-- Website Link -->
            {% if school.website %}
            <a href="{{ school.website }}" target="_blank" class="btn btn-primary" style="margin-top: 20px; border-radius: 24px; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; padding: 14px 28px;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                {{ _('visit_website_full').format(school.name) }}
            </a>
            {% endif %}
        </div>
        
        <!-- Google Maps -->
        {% if school.address %}
        <div style="margin-top: 24px; padding-top: 20px; border-top: 1px solid rgba(0,0,0,0.06);">
            <h4 style="font-size: 0.9rem; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--primary);" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                {{ _('map_location') }}
            </h4>
            <div style="border-radius: 14px; overflow: hidden; margin-bottom: 12px;">
                <iframe width="100%" height="180" style="border:0;" loading="lazy" allowfullscreen referrerpolicy="no-referrer-when-downgrade" src="https://www.google.com/maps/embed?hl={{ current_lang }}&q={{ (school.address ~ ', ' ~ school.city ~ ', ' ~ school.country) | urlencode }}&zoom=16&maptype=roadmap"></iframe>
            </div>
            <a href="https://www.google.com/maps/search/?api=1&query={{ (school.address ~ ', ' ~ school.city ~ ', ' ~ school.country) | urlencode }}" target="_blank" style="display: inline-flex; align-items: center; gap: 6px; font-size: 0.85rem; color: var(--primary); font-weight: 500; text-decoration: none;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
                {{ _('view_on_maps') }}
            </a>
        </div>
        {% endif %}
    </div>
</div>

<script>
function downloadBadge() {
    const link = document.createElement('a');
    link.href = '{{ school.badge_url or url_for("static", filename="images/placeholder.png") }}';
    link.download = '{{ school.name }}_badge.png';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
</script>
{% endblock %}
