{% extends "base.html" %}

{% block title %}{{ school.name }} - Ê†°ÂæΩÁΩë{% endblock %}

{% block content %}
<div class="school-detail">
    <a href="{{ url_for('index') }}" class="back-link">
        <span>‚Üê</span> {{ _('back') }}
    </a>
    
    <div class="detail-card">
        <div class="badge-section">
            {% if school.badge_url %}
                <img src="{{ school.badge_url }}" alt="{{ school.name }} badge" class="detail-badge">
            {% else %}
                <div class="detail-badge-placeholder">üéì</div>
            {% endif %}
            
            <div class="action-buttons">
                {% if session.get('user_id') %}
                    <form action="{{ url_for('toggle_like', school_id=school.id) }}" method="POST">
                        <button type="submit" class="btn {% if user_liked %}btn-outline{% else %}btn-primary{% endif %}">
                            {% if user_liked %}
                                ‚ù§Ô∏è {{ _('liked') }}
                            {% else %}
                                ü§ç {{ _('like') }}
                            {% endif %}
                        </button>
                    </form>
                {% endif %}
                <button class="btn btn-secondary" onclick="downloadBadge()">‚¨áÔ∏è {{ _('download') }}</button>
            </div>
        </div>
        
        <div class="info-section">
            <h1>{{ school.name }}</h1>
            {% if school.name_cn %}
                <p class="name-cn">{{ school.name_cn }}</p>
            {% endif %}
            
            <div class="meta-info">
                <span class="level-badge level-{{ school.level }}">
                    {% if school.level == 'university' %}{{ _('university') }}
                    {% elif school.level == 'middle' %}{{ _('middle_school') }}
                    {% elif school.level == 'elementary' %}{{ _('elementary_school') }}
                    {% else %}{{ _('kindergarten') }}{% endif %}
                </span>
                <span class="likes-count">‚ù§Ô∏è {{ _('likes_count').format(likes_count) }}</span>
            </div>
            
            {% if school.motto %}
            <div class="motto-section">
                <p class="motto-label">{{ _('motto_label') }}</p>
                <p class="motto-text">"{{ school.motto }}"</p>
            </div>
            {% endif %}
            
            <div class="info-grid">
                <div class="info-item">
                    <p class="label">{{ _('region') }}</p>
                    <p class="value">{{ school.region }}</p>
                </div>
                <div class="info-item">
                    <p class="label">{{ _('location') }}</p>
                    <p class="value">{{ school.city }}, {{ school.country }}</p>
                </div>
                {% if school.address %}
                <div class="info-item">
                    <p class="label">{{ _('address') }}</p>
                    <p class="value">{{ school.address }}</p>
                </div>
                {% endif %}
                {% if school.principal %}
                <div class="info-item">
                    <p class="label">{{ _('principal') }}</p>
                    <p class="value">{{ school.principal }}</p>
                </div>
                {% endif %}
                {% if school.founded %}
                <div class="info-item">
                    <p class="label">{{ _('founded') }}</p>
                    <p class="value">{{ school.founded }}</p>
                </div>
                {% endif %}
                {% if school.website %}
                <div class="info-item">
                    <p class="label">{{ _('website') }}</p>
                    <p class="value"><a href="{{ school.website }}" target="_blank" class="website-text-link">üåê {{ _('visit_website') }}</a></p>
                </div>
                {% endif %}
            </div>
            
            {% if school.website %}
            <a href="{{ school.website }}" target="_blank" class="website-link">
                üåê {{ _('visit_website_full').format(school.name) }}
            </a>
            {% endif %}
            
            {% if school.description %}
                <div class="description">
                    <h3>{{ _('description_title') }}</h3>
                    <p>{{ school.description }}</p>
                </div>
            {% endif %}
            
            <!-- Google Maps -->
            {% if school.address %}
            <div class="map-section">
                <h3>üó∫Ô∏è {{ _('map_location') }}</h3>
                <div class="map-container">
                    <iframe 
                        width="100%" 
                        height="300" 
                        style="border:0; border-radius: 12px;" 
                        loading="lazy" 
                        allowfullscreen
                        referrerpolicy="no-referrer-when-downgrade"
                        src="https://www.google.com/maps/embed?hl={{ current_lang }}&q={{ (school.address ~ ', ' ~ school.city ~ ', ' ~ school.country) | urlencode }}&zoom=16&maptype=roadmap">
                    </iframe>
                </div>
                <a href="https://www.google.com/maps/search/?api=1&query={{ (school.address ~ ', ' ~ school.city ~ ', ' ~ school.country) | urlencode }}" 
                   target="_blank" class="map-link">
                    üìç {{ _('view_on_maps') }} - {{ school.address }}
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function downloadBadge() {
    const link = document.createElement('a');
    link.href = '{{ school.badge_url or url_for("static", filename="images/placeholder.png") }}';
    link.download = '{{ school.name }}_badge.png';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
</script>
{% endblock %}
